<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Half Marathon Tracker | Feb 21</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0d0a1a;
            --bg-card: #151029;
            --accent-primary: #7dd3fc;
            --accent-secondary: #a78bfa;
            --accent-green: #34d399;
            --accent-purple: #8b5cf6;
            --accent-gold: #fbbf24;
            --text-primary: #ffffff;
            --text-secondary: #a5b4c6;
            --text-muted: #5a6680;
            --gradient-main: linear-gradient(135deg, #8b5cf6 0%, #7dd3fc 100%);
            --gradient-cool: linear-gradient(135deg, #7dd3fc 0%, #34d399 100%);
            --gradient-gold: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            --glass: rgba(139, 92, 246, 0.05);
            --glass-border: rgba(125, 211, 252, 0.15);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'IBM Plex Mono', monospace; background: var(--bg-dark); color: var(--text-primary); min-height: 100vh; overflow-x: hidden; }
        .bg-pattern { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(to bottom, rgba(13, 10, 26, 0.92) 0%, rgba(13, 10, 26, 0.88) 50%, rgba(13, 10, 26, 0.92) 100%), url('https://images.unsplash.com/photo-1616169201999-0d80789ed10f?w=1200&q=80'); background-size: cover; background-position: center; background-attachment: fixed; pointer-events: none; z-index: 0; }
        .bg-pattern::after { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: radial-gradient(ellipse 80% 50% at 20% -10%, rgba(139, 92, 246, 0.15) 0%, transparent 50%), radial-gradient(ellipse 60% 40% at 80% 110%, rgba(125, 211, 252, 0.12) 0%, transparent 50%); pointer-events: none; }
        .container { position: relative; z-index: 1; max-width: 600px; margin: 0 auto; padding: 1.5rem; }
        header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--glass-border); }
        .logo-section h1 { font-weight: 700; font-size: 1.5rem; letter-spacing: -0.02em; line-height: 1.1; background: var(--gradient-main); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .logo-section .subtitle { font-size: 0.7rem; color: var(--text-muted); margin-top: 0.25rem; }
        .race-countdown { text-align: right; }
        .race-countdown .label { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 0.15em; color: var(--text-muted); margin-bottom: 0.25rem; }
        .race-countdown .days { font-weight: 700; font-size: 2.5rem; line-height: 1; color: var(--accent-primary); }
        .race-countdown .days-label { font-size: 0.65rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.1em; }
        .strava-section, .week-selector { background: rgba(21, 16, 41, 0.85); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid var(--glass-border); border-radius: 16px; padding: 1rem 1.25rem; margin-bottom: 1.5rem; }
        .strava-status { display: flex; align-items: center; justify-content: center; }
        .strava-disconnected { display: flex; align-items: center; gap: 1rem; flex-wrap: wrap; justify-content: center; }
        .strava-btn { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.6rem 1.25rem; background: #fc4c02; color: white; font-family: 'IBM Plex Mono', monospace; font-weight: 600; font-size: 0.8rem; border: none; border-radius: 50px; cursor: pointer; transition: all 0.3s ease; }
        .strava-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(252, 76, 2, 0.35); }
        .strava-hint { font-size: 0.7rem; color: var(--text-muted); }
        .strava-connected { display: flex; align-items: center; justify-content: space-between; width: 100%; flex-wrap: wrap; gap: 0.75rem; }
        .strava-user { display: flex; align-items: center; gap: 0.5rem; font-size: 0.8rem; color: var(--text-secondary); }
        .strava-actions { display: flex; gap: 0.5rem; }
        .sync-btn { display: inline-flex; align-items: center; gap: 0.4rem; padding: 0.5rem 1rem; background: rgba(252, 76, 2, 0.15); color: #fc4c02; font-family: 'IBM Plex Mono', monospace; font-weight: 500; font-size: 0.75rem; border: 1px solid rgba(252, 76, 2, 0.3); border-radius: 50px; cursor: pointer; transition: all 0.3s ease; }
        .sync-btn:hover { background: rgba(252, 76, 2, 0.25); }
        .sync-btn.loading svg { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .disconnect-btn { padding: 0.5rem 0.75rem; background: transparent; color: var(--text-muted); font-family: 'IBM Plex Mono', monospace; font-size: 0.7rem; border: none; cursor: pointer; }
        .disconnect-btn:hover { color: #ff6b6b; }
        .hidden { display: none !important; }
        .week-selector { display: flex; align-items: center; justify-content: space-between; gap: 0.75rem; }
        .week-nav-btn { background: rgba(255, 255, 255, 0.05); border: 1px solid var(--glass-border); border-radius: 8px; padding: 0.5rem 0.75rem; color: var(--text-secondary); font-family: 'IBM Plex Mono', monospace; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; }
        .week-nav-btn:hover:not(:disabled) { background: rgba(125, 211, 252, 0.1); border-color: var(--accent-primary); color: var(--accent-primary); }
        .week-nav-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        .week-display { text-align: center; flex: 1; }
        .week-display .week-label { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); margin-bottom: 0.25rem; }
        .week-display .week-dates { font-size: 0.85rem; font-weight: 600; color: var(--text-primary); }
        .week-display .week-number { font-size: 0.65rem; color: var(--accent-primary); margin-top: 0.2rem; }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .stat-card { background: rgba(21, 16, 41, 0.85); backdrop-filter: blur(10px); border: 1px solid var(--glass-border); border-radius: 16px; padding: 1.25rem; }
        .stat-card.highlight { background: linear-gradient(135deg, rgba(139, 92, 246, 0.12) 0%, rgba(125, 211, 252, 0.08) 100%); border-color: rgba(125, 211, 252, 0.25); }
        .stat-card .label { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 0.12em; color: var(--text-muted); margin-bottom: 0.5rem; }
        .stat-card .value { font-weight: 700; font-size: 2rem; line-height: 1; margin-bottom: 0.15rem; }
        .stat-card.highlight .value { color: var(--accent-primary); }
        .stat-card .unit { font-size: 0.65rem; color: var(--text-secondary); }
        .progress-card, .top-runs-section, .pb-section, .calendar-section, .add-run-section, .activities-section, .settings-section { background: rgba(21, 16, 41, 0.85); backdrop-filter: blur(10px); border: 1px solid var(--glass-border); border-radius: 20px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .progress-card h3, .top-runs-section h3, .pb-section h3, .add-run-section h3, .activities-header h3, .settings-header h3, .calendar-header h3 { font-weight: 600; font-size: 0.75rem; letter-spacing: 0.08em; margin-bottom: 1.25rem; color: var(--text-secondary); text-transform: uppercase; }
        .circular-progress { display: flex; align-items: center; gap: 1.5rem; }
        .circle-container { position: relative; width: 120px; height: 120px; flex-shrink: 0; }
        .circle-container svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        .circle-bg { fill: none; stroke: var(--glass-border); stroke-width: 8; }
        .circle-progress { fill: none; stroke: url(#progressGradient); stroke-width: 8; stroke-linecap: round; stroke-dasharray: 314; stroke-dashoffset: 314; transition: stroke-dashoffset 1s ease-out; }
        .circle-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
        .circle-center .percent { font-weight: 700; font-size: 1.5rem; color: var(--accent-primary); }
        .circle-center .of-target { font-size: 0.55rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.08em; }
        .progress-details { flex: 1; }
        .progress-details .item { display: flex; justify-content: space-between; padding: 0.6rem 0; border-bottom: 1px solid var(--glass-border); font-size: 0.8rem; }
        .progress-details .item:last-child { border-bottom: none; }
        .progress-details .item-label { color: var(--text-secondary); }
        .progress-details .item-value { font-weight: 600; }
        .chart-bars { display: flex; align-items: flex-end; justify-content: space-between; height: 140px; gap: 0.4rem; padding: 0.75rem 0; }
        .bar-container { flex: 1; display: flex; flex-direction: column; align-items: center; height: 100%; }
        .bar-wrapper { flex: 1; width: 100%; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; position: relative; }
        .bar-target { position: absolute; bottom: 0; width: 100%; background: rgba(255, 255, 255, 0.05); border-radius: 6px 6px 0 0; }
        .bar { width: 100%; border-radius: 6px 6px 0 0; background: var(--gradient-main); position: relative; z-index: 1; min-height: 3px; cursor: pointer; transition: all 0.3s ease; }
        .bar:hover { filter: brightness(1.2); }
        .bar.exceeded { background: var(--gradient-cool); }
        .bar-day { margin-top: 0.5rem; font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.08em; }
        .bar-day.today { color: var(--accent-primary); font-weight: 600; }
        .bar-value { font-size: 0.55rem; color: var(--text-secondary); margin-top: 0.2rem; }
        .top-run-item { display: flex; align-items: center; gap: 1rem; padding: 0.9rem 1rem; background: rgba(255, 255, 255, 0.02); border-radius: 10px; margin-bottom: 0.5rem; }
        .top-run-item:last-child { margin-bottom: 0; }
        .medal { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.85rem; flex-shrink: 0; }
        .medal.gold { background: var(--gradient-gold); color: #1a1a1a; }
        .medal.silver { background: linear-gradient(135deg, #e2e8f0 0%, #94a3b8 100%); color: #1a1a1a; }
        .medal.bronze { background: linear-gradient(135deg, #cd7c32 0%, #a85d20 100%); color: #fff; }
        .top-run-info { flex: 1; }
        .top-run-name { font-weight: 500; font-size: 0.85rem; margin-bottom: 0.15rem; }
        .top-run-date { font-size: 0.65rem; color: var(--text-muted); }
        .top-run-distance { font-weight: 700; font-size: 1.1rem; color: var(--accent-primary); }
        .pb-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; }
        .pb-card { background: rgba(255, 255, 255, 0.03); border: 1px solid var(--glass-border); border-radius: 12px; padding: 0.85rem; text-align: center; }
        .pb-card.achieved { border-color: rgba(251, 191, 36, 0.3); background: rgba(251, 191, 36, 0.05); }
        .pb-distance { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); margin-bottom: 0.3rem; }
        .pb-time { font-weight: 700; font-size: 1rem; color: var(--text-primary); margin-bottom: 0.2rem; }
        .pb-card.achieved .pb-time { color: var(--accent-gold); }
        .pb-date { font-size: 0.55rem; color: var(--text-muted); }
        .pb-none { font-size: 0.7rem; color: var(--text-muted); }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .calendar-header h3 { margin-bottom: 0; }
        .calendar-nav { display: flex; align-items: center; gap: 0.5rem; }
        .calendar-nav-btn { background: rgba(255, 255, 255, 0.05); border: 1px solid var(--glass-border); border-radius: 6px; padding: 0.3rem 0.5rem; color: var(--text-secondary); font-size: 0.75rem; cursor: pointer; transition: all 0.3s ease; }
        .calendar-nav-btn:hover { background: rgba(125, 211, 252, 0.1); border-color: var(--accent-primary); color: var(--accent-primary); }
        .calendar-month { font-size: 0.8rem; font-weight: 600; color: var(--text-primary); min-width: 100px; text-align: center; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.3rem; }
        .calendar-day-header { text-align: center; font-size: 0.5rem; text-transform: uppercase; color: var(--text-muted); padding: 0.4rem 0; letter-spacing: 0.05em; }
        .calendar-day { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; font-size: 0.65rem; border-radius: 6px; color: var(--text-muted); }
        .calendar-day.current-month { color: var(--text-secondary); }
        .calendar-day.today { border: 1px solid var(--accent-primary); color: var(--accent-primary); }
        .calendar-day.has-run { background: var(--gradient-main); color: white; font-weight: 600; }
        .calendar-day.has-run.today { border: 2px solid white; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 1rem; }
        .form-group { display: flex; flex-direction: column; gap: 0.4rem; }
        .form-group label { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); }
        .form-group input { background: rgba(255, 255, 255, 0.05); border: 1px solid var(--glass-border); border-radius: 10px; padding: 0.75rem; color: var(--text-primary); font-family: 'IBM Plex Mono', monospace; font-size: 0.9rem; width: 100%; transition: all 0.3s ease; }
        .form-group input:focus { outline: none; border-color: var(--accent-primary); background: rgba(125, 211, 252, 0.08); }
        .add-btn { width: 100%; padding: 0.9rem; background: var(--gradient-main); border: none; border-radius: 12px; color: white; font-family: 'IBM Plex Mono', monospace; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.3s ease; }
        .add-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3); }
        .activities-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .activities-header h3 { margin-bottom: 0; }
        .clear-btn { font-size: 0.65rem; color: var(--text-muted); background: none; border: none; cursor: pointer; font-family: 'IBM Plex Mono', monospace; }
        .clear-btn:hover { color: #ff6b6b; }
        .activity-list { display: flex; flex-direction: column; gap: 0.6rem; max-height: 250px; overflow-y: auto; }
        .activity-item { display: flex; justify-content: space-between; align-items: center; padding: 0.9rem 1rem; background: rgba(255, 255, 255, 0.02); border-radius: 10px; }
        .activity-info { flex: 1; }
        .activity-name { font-weight: 500; font-size: 0.85rem; margin-bottom: 0.2rem; }
        .activity-date { font-size: 0.65rem; color: var(--text-muted); }
        .activity-distance { font-weight: 600; font-size: 1rem; color: var(--accent-primary); }
        .activity-delete { background: none; border: none; color: var(--text-muted); cursor: pointer; padding: 0.5rem; margin-left: 0.5rem; font-size: 1rem; }
        .activity-delete:hover { color: #ff6b6b; }
        .settings-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; cursor: pointer; }
        .settings-header h3 { margin-bottom: 0; }
        .settings-toggle { font-size: 0.8rem; color: var(--text-muted); transition: transform 0.3s ease; }
        .settings-content { display: none; }
        .settings-content.open { display: block; }
        .settings-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.5rem; }
        .day-setting { display: flex; flex-direction: column; gap: 0.3rem; }
        .day-setting label { font-size: 0.55rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); text-align: center; }
        .day-setting input { background: rgba(255, 255, 255, 0.05); border: 1px solid var(--glass-border); border-radius: 8px; padding: 0.6rem 0.3rem; color: var(--text-primary); font-family: 'IBM Plex Mono', monospace; font-size: 0.8rem; width: 100%; text-align: center; }
        .day-setting input:focus { outline: none; border-color: var(--accent-primary); }
        .save-btn { margin-top: 1rem; width: 100%; padding: 0.75rem; background: transparent; border: 1px solid var(--glass-border); border-radius: 10px; color: var(--text-secondary); font-family: 'IBM Plex Mono', monospace; font-weight: 500; font-size: 0.8rem; cursor: pointer; transition: all 0.3s ease; }
        .save-btn:hover { border-color: var(--accent-primary); color: var(--accent-primary); }
        .toast { position: fixed; bottom: 1.5rem; left: 50%; transform: translateX(-50%) translateY(100px); padding: 0.9rem 1.5rem; background: var(--bg-card); border: 1px solid var(--glass-border); border-radius: 12px; color: var(--text-primary); font-size: 0.8rem; opacity: 0; transition: all 0.3s ease; z-index: 1001; }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .toast.success { border-color: var(--accent-green); }
        .empty-state { text-align: center; padding: 2rem; color: var(--text-muted); font-size: 0.8rem; }
        footer { text-align: center; padding: 1.5rem; color: var(--text-muted); font-size: 0.65rem; }
    </style>
</head>
<body>
    <div class="bg-pattern"></div>
    <div class="container">
        <header>
            <div class="logo-section"><h1>HALF MARATHON<br>TRACKER</h1><div class="subtitle">Feb 21, 2026</div></div>
            <div class="race-countdown"><div class="label">Race Day</div><div class="days" id="daysLeft">--</div><div class="days-label">Days</div></div>
        </header>
        <div class="strava-section" id="stravaSection">
            <div class="strava-status" id="stravaStatus">
                <div class="strava-disconnected" id="stravaDisconnected">
                    <button class="strava-btn" onclick="connectStrava()"><svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M15.387 17.944l-2.089-4.116h-3.065L15.387 24l5.15-10.172h-3.066m-7.008-5.599l2.836 5.598h4.172L10.463 0l-7 13.828h4.169"/></svg>Connect Strava</button>
                    <span class="strava-hint">Auto-sync your runs</span>
                </div>
                <div class="strava-connected hidden" id="stravaConnected">
                    <div class="strava-user"><svg viewBox="0 0 24 24" fill="#fc4c02" width="18" height="18"><path d="M15.387 17.944l-2.089-4.116h-3.065L15.387 24l5.15-10.172h-3.066m-7.008-5.599l2.836 5.598h4.172L10.463 0l-7 13.828h4.169"/></svg><span id="stravaUserName">Connected</span></div>
                    <div class="strava-actions"><button class="sync-btn" onclick="syncStrava()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>Sync</button><button class="disconnect-btn" onclick="disconnectStrava()">Disconnect</button></div>
                </div>
            </div>
        </div>
        <div class="week-selector">
            <button class="week-nav-btn" onclick="changeWeek(-1)" id="prevWeekBtn">‚óÄ</button>
            <div class="week-display"><div class="week-label">Viewing Week</div><div class="week-dates" id="weekDates">Jan 1 - Jan 7</div><div class="week-number" id="weekNumber">Week 1 of 2026</div></div>
            <button class="week-nav-btn" onclick="changeWeek(1)" id="nextWeekBtn">‚ñ∂</button>
        </div>
        <div class="stats-grid">
            <div class="stat-card highlight"><div class="label">This Week</div><div class="value" id="weekDistance">0</div><div class="unit">km</div></div>
            <div class="stat-card"><div class="label">Total 2026</div><div class="value" id="totalDistance">0</div><div class="unit">km</div></div>
            <div class="stat-card"><div class="label">Week Runs</div><div class="value" id="weekRuns">0</div><div class="unit">runs</div></div>
            <div class="stat-card"><div class="label">Total Runs</div><div class="value" id="totalRuns">0</div><div class="unit">runs</div></div>
        </div>
        <div class="progress-card">
            <h3>Weekly Progress</h3>
            <div class="circular-progress">
                <div class="circle-container"><svg viewBox="0 0 120 120"><defs><linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#8b5cf6"/><stop offset="100%" stop-color="#7dd3fc"/></linearGradient></defs><circle class="circle-bg" cx="60" cy="60" r="50"/><circle class="circle-progress" id="progressCircle" cx="60" cy="60" r="50"/></svg><div class="circle-center"><div class="percent" id="progressPercent">0%</div><div class="of-target">of target</div></div></div>
                <div class="progress-details"><div class="item"><span class="item-label">Done</span><span class="item-value" id="completedKm">0 km</span></div><div class="item"><span class="item-label">Target</span><span class="item-value" id="weeklyTarget">0 km</span></div><div class="item"><span class="item-label">Remaining</span><span class="item-value" id="remainingKm">0 km</span></div></div>
            </div>
        </div>
        <div class="progress-card"><h3>Selected Week</h3><div class="chart-bars" id="weeklyBars"></div></div>
        <div class="top-runs-section"><h3>üèÜ Top 3 Longest Runs of 2026</h3><div id="topRunsList"><div class="empty-state">No runs yet</div></div></div>
        <div class="pb-section"><h3>‚ö° Personal Bests 2026</h3><div class="pb-grid" id="pbGrid"></div></div>
        <div class="calendar-section">
            <div class="calendar-header"><h3>üìÖ Running Calendar</h3><div class="calendar-nav"><button class="calendar-nav-btn" onclick="changeMonth(-1)">‚óÄ</button><span class="calendar-month" id="calendarMonth">January 2026</span><button class="calendar-nav-btn" onclick="changeMonth(1)">‚ñ∂</button></div></div>
            <div class="calendar-grid" id="calendarGrid"></div>
        </div>
        <div class="add-run-section">
            <h3>Log a Run</h3>
            <div class="form-row"><div class="form-group"><label>Distance (km)</label><input type="number" id="runDistance" placeholder="5.0" step="0.1" min="0"></div><div class="form-group"><label>Date</label><input type="date" id="runDate"></div></div>
            <div class="form-row"><div class="form-group"><label>Duration (mins)</label><input type="number" id="runDuration" placeholder="30" min="0"></div><div class="form-group"><label>Run Name</label><input type="text" id="runName" placeholder="Morning Run"></div></div>
            <button class="add-btn" onclick="addRun()">+ Add Run</button>
        </div>
        <div class="activities-section">
            <div class="activities-header"><h3>Recent Runs</h3><button class="clear-btn" onclick="clearAllRuns()">Clear Manual</button></div>
            <div class="activity-list" id="activityList"><div class="empty-state">No runs logged yet</div></div>
        </div>
        <div class="settings-section">
            <div class="settings-header" onclick="toggleSettings()"><h3>Daily Targets (km)</h3><span class="settings-toggle" id="settingsToggle">‚ñº</span></div>
            <div class="settings-content" id="settingsContent">
                <div class="settings-grid"><div class="day-setting"><label>Mon</label><input type="number" id="target-mon" value="5" min="0" step="0.5"></div><div class="day-setting"><label>Tue</label><input type="number" id="target-tue" value="0" min="0" step="0.5"></div><div class="day-setting"><label>Wed</label><input type="number" id="target-wed" value="8" min="0" step="0.5"></div><div class="day-setting"><label>Thu</label><input type="number" id="target-thu" value="0" min="0" step="0.5"></div><div class="day-setting"><label>Fri</label><input type="number" id="target-fri" value="5" min="0" step="0.5"></div><div class="day-setting"><label>Sat</label><input type="number" id="target-sat" value="12" min="0" step="0.5"></div><div class="day-setting"><label>Sun</label><input type="number" id="target-sun" value="0" min="0" step="0.5"></div></div>
                <button class="save-btn" onclick="saveTargets()">Save Targets</button>
            </div>
        </div>
        <footer>Half Marathon: February 21, 2026 ‚Ä¢ 21.1 km</footer>
    </div>
    <div class="toast" id="toast"></div>
    <script>
        const STRAVA_CLIENT_ID = '202801';
        const STRAVA_CLIENT_SECRET = '8cdd1c1a4db4e42ed1984efe14ab3c2d88945e55';
        const REDIRECT_URI = window.location.origin + window.location.pathname;
        const RACE_DATE = new Date('2026-02-21');
        let runs = JSON.parse(localStorage.getItem('halfmarathon_runs')) || [];
        let stravaRuns = JSON.parse(localStorage.getItem('halfmarathon_strava_runs')) || [];
        let dailyTargets = JSON.parse(localStorage.getItem('halfmarathon_targets')) || { mon: 5, tue: 0, wed: 8, thu: 0, fri: 5, sat: 12, sun: 0 };
        let selectedWeekStart = getWeekStart(new Date());
        let selectedMonth = new Date().getMonth();
        let selectedYear = 2026;
        let accessToken = localStorage.getItem('strava_access_token');
        let refreshToken = localStorage.getItem('strava_refresh_token');
        let tokenExpiry = localStorage.getItem('strava_token_expiry');
        let athleteName = localStorage.getItem('strava_athlete_name');
        const PB_CATEGORIES = [{ name: '1K', min: 1, max: 1.5 }, { name: '3K', min: 3, max: 3.5 }, { name: '5K', min: 5, max: 5.5 }, { name: '10K', min: 10, max: 10.5 }, { name: '15K', min: 15, max: 15.5 }, { name: '21K', min: 21, max: 21.5 }];

        document.addEventListener('DOMContentLoaded', init);
        async function init() {
            updateCountdown(); setInterval(updateCountdown, 60000);
            document.getElementById('runDate').valueAsDate = new Date();
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            if (code) { await exchangeToken(code); window.history.replaceState({}, document.title, window.location.pathname); }
            updateStravaUI();
            if (accessToken) { if (tokenExpiry && Date.now() / 1000 > tokenExpiry) { await refreshAccessToken(); } await syncStrava(); }
            loadTargetsToInputs(); updateDashboard(); updateCalendar();
        }
        function updateCountdown() { const now = new Date(); const diff = RACE_DATE - now; const days = Math.ceil(diff / (1000 * 60 * 60 * 24)); document.getElementById('daysLeft').textContent = days > 0 ? days : 0; }
        function getWeekStart(date) { const d = new Date(date); const day = d.getDay(); const diff = d.getDate() - day + (day === 0 ? -6 : 1); d.setDate(diff); d.setHours(0, 0, 0, 0); return d; }
        function getWeekNumber(date) { const startOfYear = new Date(date.getFullYear(), 0, 1); const days = Math.floor((date - startOfYear) / (24 * 60 * 60 * 1000)); return Math.ceil((days + startOfYear.getDay() + 1) / 7); }
        function changeWeek(direction) {
            const newWeek = new Date(selectedWeekStart); newWeek.setDate(newWeek.getDate() + (direction * 7));
            const minWeekStart = getWeekStart(new Date('2026-01-01')); const maxWeekStart = getWeekStart(new Date());
            if (newWeek >= minWeekStart && newWeek <= maxWeekStart) { selectedWeekStart = newWeek; updateDashboard(); }
            document.getElementById('prevWeekBtn').disabled = selectedWeekStart <= minWeekStart;
            document.getElementById('nextWeekBtn').disabled = selectedWeekStart >= maxWeekStart;
        }
        function updateWeekDisplay() {
            const weekEnd = new Date(selectedWeekStart); weekEnd.setDate(weekEnd.getDate() + 6);
            const formatDate = (d) => d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            document.getElementById('weekDates').textContent = formatDate(selectedWeekStart) + ' - ' + formatDate(weekEnd);
            document.getElementById('weekNumber').textContent = 'Week ' + getWeekNumber(selectedWeekStart) + ' of ' + selectedWeekStart.getFullYear();
            const minWeekStart = getWeekStart(new Date('2026-01-01')); const maxWeekStart = getWeekStart(new Date());
            document.getElementById('prevWeekBtn').disabled = selectedWeekStart <= minWeekStart;
            document.getElementById('nextWeekBtn').disabled = selectedWeekStart >= maxWeekStart;
        }
        function updateStravaUI() { const disconnected = document.getElementById('stravaDisconnected'); const connected = document.getElementById('stravaConnected'); const userName = document.getElementById('stravaUserName'); if (accessToken) { disconnected.classList.add('hidden'); connected.classList.remove('hidden'); userName.textContent = athleteName || 'Connected to Strava'; } else { disconnected.classList.remove('hidden'); connected.classList.add('hidden'); } }
        function connectStrava() { const scope = 'activity:read_all'; const authUrl = 'https://www.strava.com/oauth/authorize?client_id=' + STRAVA_CLIENT_ID + '&redirect_uri=' + encodeURIComponent(REDIRECT_URI) + '&response_type=code&scope=' + scope; window.location.href = authUrl; }
        async function exchangeToken(code) { try { showToast('Connecting to Strava...', 'success'); const response = await fetch('https://www.strava.com/oauth/token', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ client_id: STRAVA_CLIENT_ID, client_secret: STRAVA_CLIENT_SECRET, code: code, grant_type: 'authorization_code' }) }); const data = await response.json(); if (data.access_token) { accessToken = data.access_token; refreshToken = data.refresh_token; tokenExpiry = data.expires_at; athleteName = data.athlete ? data.athlete.firstname + ' ' + data.athlete.lastname : 'Connected'; localStorage.setItem('strava_access_token', accessToken); localStorage.setItem('strava_refresh_token', refreshToken); localStorage.setItem('strava_token_expiry', tokenExpiry); localStorage.setItem('strava_athlete_name', athleteName); updateStravaUI(); showToast('Connected to Strava!', 'success'); } else { throw new Error(data.message || 'Token exchange failed'); } } catch (error) { console.error('Auth error:', error); showToast('Failed to connect to Strava', 'error'); } }
        async function refreshAccessToken() { try { const response = await fetch('https://www.strava.com/oauth/token', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ client_id: STRAVA_CLIENT_ID, client_secret: STRAVA_CLIENT_SECRET, refresh_token: refreshToken, grant_type: 'refresh_token' }) }); const data = await response.json(); if (data.access_token) { accessToken = data.access_token; refreshToken = data.refresh_token; tokenExpiry = data.expires_at; localStorage.setItem('strava_access_token', accessToken); localStorage.setItem('strava_refresh_token', refreshToken); localStorage.setItem('strava_token_expiry', tokenExpiry); } else { throw new Error('Token refresh failed'); } } catch (error) { console.error('Token refresh error:', error); disconnectStrava(); } }
        async function syncStrava() { if (!accessToken) { showToast('Please connect Strava first', 'error'); return; } const syncBtn = document.querySelector('.sync-btn'); if (syncBtn) syncBtn.classList.add('loading'); try { if (tokenExpiry && Date.now() / 1000 > tokenExpiry) { await refreshAccessToken(); } const startDate = Math.floor(new Date('2026-01-01').getTime() / 1000); const response = await fetch('https://www.strava.com/api/v3/athlete/activities?after=' + startDate + '&per_page=200', { headers: { 'Authorization': 'Bearer ' + accessToken } }); if (response.status === 401) { await refreshAccessToken(); return syncStrava(); } const data = await response.json(); if (Array.isArray(data)) { stravaRuns = data.filter(activity => { const name = activity.name.toLowerCase(); return activity.type === 'Run' && (name.includes('run') || name.includes('running')); }).map(activity => ({ id: 'strava_' + activity.id, name: activity.name, distance: activity.distance / 1000, date: activity.start_date.split('T')[0], source: 'strava', pace: activity.moving_time / 60 / (activity.distance / 1000), duration: Math.round(activity.moving_time / 60) })); localStorage.setItem('halfmarathon_strava_runs', JSON.stringify(stravaRuns)); updateDashboard(); updateCalendar(); showToast('Synced ' + stravaRuns.length + ' runs from Strava!', 'success'); } else { throw new Error('Invalid response from Strava'); } } catch (error) { console.error('Sync error:', error); showToast('Failed to sync with Strava', 'error'); } finally { if (syncBtn) syncBtn.classList.remove('loading'); } }
        function disconnectStrava() { accessToken = null; refreshToken = null; tokenExpiry = null; athleteName = null; stravaRuns = []; localStorage.removeItem('strava_access_token'); localStorage.removeItem('strava_refresh_token'); localStorage.removeItem('strava_token_expiry'); localStorage.removeItem('strava_athlete_name'); localStorage.removeItem('halfmarathon_strava_runs'); updateStravaUI(); updateDashboard(); updateCalendar(); showToast('Disconnected from Strava', 'success'); }
        function getAllRuns() { const allRuns = [...stravaRuns, ...runs]; allRuns.sort((a, b) => new Date(b.date) - new Date(a.date)); return allRuns; }
        function get2026Runs() { return getAllRuns().filter(r => r.date >= '2026-01-01'); }
        function addRun() { const distance = parseFloat(document.getElementById('runDistance').value); const date = document.getElementById('runDate').value; const duration = parseFloat(document.getElementById('runDuration').value) || null; const name = document.getElementById('runName').value || 'Manual Run'; if (!distance || distance <= 0) { showToast('Please enter a valid distance', 'error'); return; } if (!date) { showToast('Please select a date', 'error'); return; } const run = { id: Date.now(), name: name, distance: distance, date: date, source: 'manual', duration: duration, pace: duration ? duration / distance : null }; runs.unshift(run); localStorage.setItem('halfmarathon_runs', JSON.stringify(runs)); document.getElementById('runDistance').value = ''; document.getElementById('runDuration').value = ''; document.getElementById('runName').value = ''; document.getElementById('runDate').valueAsDate = new Date(); updateDashboard(); updateCalendar(); showToast('Added ' + distance + ' km run!', 'success'); }
        function deleteRun(id) { const idStr = String(id); if (idStr.startsWith('strava_')) { showToast('Cannot delete Strava runs', 'error'); return; } runs = runs.filter(r => r.id !== id); localStorage.setItem('halfmarathon_runs', JSON.stringify(runs)); updateDashboard(); updateCalendar(); showToast('Run deleted', 'success'); }
        function clearAllRuns() { if (confirm('Delete all manual runs? Strava runs will remain.')) { runs = []; localStorage.setItem('halfmarathon_runs', JSON.stringify(runs)); updateDashboard(); updateCalendar(); showToast('Manual runs cleared', 'success'); } }
        function updateDashboard() { const allRuns = get2026Runs(); const weekEnd = new Date(selectedWeekStart); weekEnd.setDate(weekEnd.getDate() + 7); const thisWeekRuns = allRuns.filter(r => { const date = new Date(r.date); return date >= selectedWeekStart && date < weekEnd; }); const weekDistance = thisWeekRuns.reduce((sum, r) => sum + r.distance, 0); const totalDistance = allRuns.reduce((sum, r) => sum + r.distance, 0); document.getElementById('weekDistance').textContent = weekDistance.toFixed(1); document.getElementById('totalDistance').textContent = totalDistance.toFixed(1); document.getElementById('weekRuns').textContent = thisWeekRuns.length; document.getElementById('totalRuns').textContent = allRuns.length; const weeklyTargetKm = Object.values(dailyTargets).reduce((sum, t) => sum + t, 0); const progressPercent = weeklyTargetKm > 0 ? Math.min(100, (weekDistance / weeklyTargetKm) * 100) : 0; const circle = document.getElementById('progressCircle'); const circumference = 2 * Math.PI * 50; circle.style.strokeDashoffset = circumference - (circumference * progressPercent / 100); document.getElementById('progressPercent').textContent = Math.round(progressPercent) + '%'; document.getElementById('completedKm').textContent = weekDistance.toFixed(1) + ' km'; document.getElementById('weeklyTarget').textContent = weeklyTargetKm + ' km'; document.getElementById('remainingKm').textContent = Math.max(0, weeklyTargetKm - weekDistance).toFixed(1) + ' km'; updateWeekDisplay(); updateWeeklyChart(thisWeekRuns); updateTopRuns(allRuns); updatePersonalBests(allRuns); updateActivityList(allRuns); }
        function updateWeeklyChart(weekRuns) { const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']; const dayKeys = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun']; const today = new Date(); const todayWeekStart = getWeekStart(today); const isCurrentWeek = selectedWeekStart.getTime() === todayWeekStart.getTime(); const todayIndex = isCurrentWeek ? (today.getDay() + 6) % 7 : -1; const dailyDistances = {}; days.forEach((_, i) => { dailyDistances[i] = 0; }); weekRuns.forEach(run => { const date = new Date(run.date); const dayIndex = (date.getDay() + 6) % 7; dailyDistances[dayIndex] += run.distance; }); const maxTarget = Math.max(...Object.values(dailyTargets)); const maxActual = Math.max(...Object.values(dailyDistances)); const maxValue = Math.max(maxTarget, maxActual, 1); const barsContainer = document.getElementById('weeklyBars'); barsContainer.innerHTML = days.map((day, i) => { const actual = dailyDistances[i]; const target = dailyTargets[dayKeys[i]]; const actualHeight = (actual / maxValue) * 100; const targetHeight = (target / maxValue) * 100; const exceeded = actual >= target && target > 0; const isToday = i === todayIndex; return '<div class="bar-container"><div class="bar-wrapper"><div class="bar-target" style="height: ' + targetHeight + '%"></div><div class="bar ' + (exceeded ? 'exceeded' : '') + '" style="height: ' + actualHeight + '%"></div></div><div class="bar-day ' + (isToday ? 'today' : '') + '">' + day + '</div><div class="bar-value">' + (actual > 0 ? actual.toFixed(1) : '-') + '</div></div>'; }).join(''); }
        function updateTopRuns(allRuns) { const sortedByDistance = [...allRuns].sort((a, b) => b.distance - a.distance); const top3 = sortedByDistance.slice(0, 3); const container = document.getElementById('topRunsList'); if (top3.length === 0) { container.innerHTML = '<div class="empty-state">No runs yet - get running! üèÉ</div>'; return; } const medals = ['gold', 'silver', 'bronze']; const emojis = ['ü•á', 'ü•à', 'ü•â']; container.innerHTML = top3.map((run, i) => { const date = new Date(run.date); const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }); return '<div class="top-run-item"><div class="medal ' + medals[i] + '">' + emojis[i] + '</div><div class="top-run-info"><div class="top-run-name">' + run.name + '</div><div class="top-run-date">' + dateStr + '</div></div><div class="top-run-distance">' + run.distance.toFixed(2) + ' km</div></div>'; }).join(''); }
        function updatePersonalBests(allRuns) { const container = document.getElementById('pbGrid'); const pbs = PB_CATEGORIES.map(cat => { const eligibleRuns = allRuns.filter(r => r.distance >= cat.min && r.distance < cat.max && r.pace); if (eligibleRuns.length === 0) { return { ...cat, pb: null }; } const fastest = eligibleRuns.reduce((best, run) => !best || run.pace < best.pace ? run : best, null); return { ...cat, pb: fastest }; }); container.innerHTML = pbs.map(pb => { if (!pb.pb) { return '<div class="pb-card"><div class="pb-distance">' + pb.name + '</div><div class="pb-none">--</div></div>'; } const totalMins = pb.pb.pace * pb.pb.distance; const mins = Math.floor(totalMins); const secs = Math.round((totalMins % 1) * 60); const timeStr = mins + ':' + String(secs).padStart(2, '0'); const date = new Date(pb.pb.date); const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }); return '<div class="pb-card achieved"><div class="pb-distance">' + pb.name + '</div><div class="pb-time">' + timeStr + '</div><div class="pb-date">' + dateStr + '</div></div>'; }).join(''); }
        function changeMonth(direction) { selectedMonth += direction; if (selectedMonth > 11) { selectedMonth = 0; selectedYear++; } else if (selectedMonth < 0) { selectedMonth = 11; selectedYear--; } updateCalendar(); }
        function updateCalendar() { const allRuns = get2026Runs(); const runDates = new Set(allRuns.map(r => r.date)); const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']; document.getElementById('calendarMonth').textContent = monthNames[selectedMonth] + ' ' + selectedYear; const firstDay = new Date(selectedYear, selectedMonth, 1); const lastDay = new Date(selectedYear, selectedMonth + 1, 0); const startPadding = (firstDay.getDay() + 6) % 7; const today = new Date(); const todayStr = today.toISOString().split('T')[0]; let html = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'].map(d => '<div class="calendar-day-header">' + d + '</div>').join(''); for (let i = 0; i < startPadding; i++) { html += '<div class="calendar-day"></div>'; } for (let day = 1; day <= lastDay.getDate(); day++) { const dateStr = selectedYear + '-' + String(selectedMonth + 1).padStart(2, '0') + '-' + String(day).padStart(2, '0'); const hasRun = runDates.has(dateStr); const isToday = dateStr === todayStr; let classes = 'calendar-day current-month'; if (hasRun) classes += ' has-run'; if (isToday) classes += ' today'; html += '<div class="' + classes + '">' + day + '</div>'; } document.getElementById('calendarGrid').innerHTML = html; }
        function updateActivityList(allRuns) { const list = document.getElementById('activityList'); if (allRuns.length === 0) { list.innerHTML = '<div class="empty-state">No runs logged yet</div>'; return; } list.innerHTML = allRuns.slice(0, 20).map(run => { const date = new Date(run.date); const dateStr = date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }); const isStrava = run.source === 'strava'; const sourceIcon = isStrava ? '<svg viewBox="0 0 24 24" fill="#fc4c02" width="12" height="12" style="margin-left: 6px;"><path d="M15.387 17.944l-2.089-4.116h-3.065L15.387 24l5.15-10.172h-3.066m-7.008-5.599l2.836 5.598h4.172L10.463 0l-7 13.828h4.169"/></svg>' : ''; const paceStr = run.pace ? ' ‚Ä¢ ' + Math.floor(run.pace) + ':' + String(Math.round((run.pace % 1) * 60)).padStart(2, '0') + '/km' : ''; return '<div class="activity-item"><div class="activity-info"><div class="activity-name">' + run.name + sourceIcon + '</div><div class="activity-date">' + dateStr + paceStr + '</div></div><div class="activity-distance">' + run.distance.toFixed(1) + ' km</div>' + (!isStrava ? '<button class="activity-delete" onclick="deleteRun(' + run.id + ')">√ó</button>' : '') + '</div>'; }).join(''); }
        function toggleSettings() { const content = document.getElementById('settingsContent'); const toggle = document.getElementById('settingsToggle'); content.classList.toggle('open'); toggle.style.transform = content.classList.contains('open') ? 'rotate(180deg)' : ''; }
        function loadTargetsToInputs() { const days = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun']; days.forEach(day => { const input = document.getElementById('target-' + day); if (input) input.value = dailyTargets[day] || 0; }); }
        function saveTargets() { const days = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun']; days.forEach(day => { const input = document.getElementById('target-' + day); if (input) dailyTargets[day] = parseFloat(input.value) || 0; }); localStorage.setItem('halfmarathon_targets', JSON.stringify(dailyTargets)); updateDashboard(); showToast('Targets saved!', 'success'); }
        function showToast(message, type) { const toast = document.getElementById('toast'); toast.textContent = message; toast.className = 'toast ' + (type || 'success') + ' show'; setTimeout(() => toast.classList.remove('show'), 2500); }
    </script>
</body>
</html>
